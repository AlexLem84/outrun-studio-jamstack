---
// Futureswap-style hero section with KOTA particle background
import KotaBackgroundWrapper from './KotaBackgroundWrapper.astro';
---

<section class="relative w-full min-h-screen overflow-hidden -mt-28 pt-28" style="z-index: 1; background-color: transparent;">

  <!-- Foreground Silhouette Overlay -->
  <div class="hero-foreground" aria-hidden="true">
    <div class="hero-foreground__layer hero-foreground__layer--rear" data-depth="0.18">
      <img src="/images/overlays/rolling-hills.svg" alt="" loading="lazy" decoding="async" />
    </div>
    <div class="hero-foreground__layer hero-foreground__layer--mid" data-depth="0.35">
      <img src="/images/overlays/second-tree-line.svg" alt="" loading="lazy" decoding="async" />
    </div>
    <div class="hero-foreground__layer hero-foreground__layer--front" data-depth="0.6">
      <img src="/images/overlays/tree-line.svg" alt="" loading="lazy" decoding="async" />
    </div>
  </div>

  <!-- Main Content Container -->
  <div class="relative z-10 min-h-screen flex items-center">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        
        <!-- Left Content Section -->
        <div class="space-y-8">
          <!-- Subheader -->
          <div class="text-outrun-neon text-lg font-inter font-normal tracking-wide">
            Graphic - Web-Design - Online Marketing
          </div>
          
          <!-- Main Heading -->
          <h1 class="font-biennale text-white" style="font-size: 68px; line-height: 1.1; font-weight: 500; margin-top: 0px; margin-bottom: 30px; letter-spacing: -0.02em;">
            Digital Marketing Agency In Idaho Falls
          </h1>
          
          <!-- Description -->
          <p class="text-xl text-outrun-light-gray font-inter font-normal leading-relaxed max-w-2xl">
            Elevate Your Brand With Cutting-Edge<br>
            Digital Marketing Solutions
          </p>
          
          <!-- CTA Buttons -->
          <div class="flex flex-col sm:flex-row gap-4">
            <a 
              href="/contact" 
              class="inline-flex items-center justify-center px-8 py-4 bg-outrun-neon text-outrun-darker font-inter font-medium text-lg rounded-lg hover:bg-outrun-neon-bright transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl"
            >
              Get Started
            </a>
            <a 
              href="/portfolio" 
              class="inline-flex items-center justify-center px-8 py-4 border-2 border-outrun-neon text-outrun-neon font-inter font-medium text-lg rounded-lg hover:bg-outrun-neon hover:text-outrun-darker transition-all duration-300 hover:scale-105"
            >
              View Portfolio
            </a>
          </div>
        </div>
        
        <!-- Right Section - Empty for KOTA particles to show through -->
        <div class="relative lg:h-[600px] flex items-center justify-center">
          <!-- KOTA particles will be visible in this area -->
        </div>
        
      </div>
    </div>
  </div>
</section>

<style>
  .hero-foreground {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 5;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    overflow: hidden;
  }

  .hero-foreground::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 9, 18, 0.55) 60%, rgba(0, 3, 6, 0.88) 100%);
    mix-blend-mode: multiply;
  }

  .hero-foreground::before {
    content: "";
    position: absolute;
    inset: -20% -10% 40% -10%;
    background: radial-gradient(120% 80% at 50% 0%, rgba(32, 255, 204, 0.22) 0%, rgba(0, 0, 0, 0) 70%);
    mix-blend-mode: screen;
    animation: aurora-shift 48s ease-in-out infinite alternate;
  }

  .hero-foreground__layer {
    position: absolute;
    bottom: 0;
    width: 120%;
    display: flex;
    justify-content: center;
    transform-origin: bottom center;
    --base-translate-y: 0%;
    --base-scale: 1;
    --parallax-x: 0px;
    --parallax-y: 0px;
    --scroll-shift: 0px;
    --depth: 0.2;
    transform: translateY(var(--base-translate-y)) scale(var(--base-scale)) translate3d(var(--parallax-x), calc(var(--parallax-y) + var(--scroll-shift)), 0);
    opacity: 0.92;
    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);
    will-change: transform;
  }

  .hero-foreground__layer img {
    width: 100%;
    max-width: 1600px;
    filter: drop-shadow(0 20px 35px rgba(0, 0, 0, 0.55));
    will-change: transform;
  }

  .hero-foreground__layer--rear {
    --base-translate-y: 14%;
    --base-scale: 1.06;
    --depth: 0.2;
    opacity: 0.72;
  }

  .hero-foreground__layer--mid {
    --base-translate-y: 6%;
    --base-scale: 1.12;
    --depth: 0.42;
    opacity: 0.9;
  }

  .hero-foreground__layer--front {
    --base-translate-y: -2%;
    --base-scale: 1.16;
    --depth: 0.72;
    opacity: 0.98;
  }

  @media (max-width: 1024px) {
    .hero-foreground__layer {
      width: 140%;
    }

    .hero-foreground__layer--rear {
      --base-scale: 1.14;
    }

    .hero-foreground__layer--mid {
      --base-translate-y: 12%;
      --base-scale: 1.24;
    }

    .hero-foreground__layer--front {
      --base-translate-y: 6%;
      --base-scale: 1.3;
    }
  }

  @media (max-width: 640px) {
    .hero-foreground__layer {
      width: 180%;
    }
  }

  @keyframes aurora-shift {
    0% {
      transform: translateX(-10%) scale(1.08);
      opacity: 0.45;
    }
    50% {
      transform: translateX(12%) scale(1.1);
      opacity: 0.65;
    }
    100% {
      transform: translateX(-6%) scale(1.07);
      opacity: 0.48;
    }
  }

  /* Layer drift animations removed to rely solely on scroll parallax */

  /* Custom animations for the crypto cards */
  .group:hover .absolute {
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }
</style>

<script>
  const heroSection = document.currentScript?.parentElement as HTMLElement;

  if (heroSection) {
    const layers = heroSection.querySelectorAll<HTMLElement>('[data-depth]');
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    const updateParallax = (xRatio: number, yRatio: number) => {
      layers.forEach((layer) => {
        const depth = Number(layer.dataset.depth || 0.2);
        const maxShift = prefersReducedMotion ? 8 : 20;
        const xShift = xRatio * maxShift * depth;
        const yShift = yRatio * maxShift * depth;
        layer.style.setProperty('--parallax-x', `${xShift}px`);
        layer.style.setProperty('--parallax-y', `${yShift}px`);
      });
    };

    const handleMouseMove = (event: MouseEvent) => {
      const rect = heroSection.getBoundingClientRect();
      const xRatio = ((event.clientX - rect.left) / rect.width - 0.5) * 2;
      const yRatio = ((event.clientY - rect.top) / rect.height - 0.5) * 2;
      updateParallax(xRatio, yRatio);
    };

    const resetParallax = () => updateParallax(0, 0);

    if (!prefersReducedMotion) {
      heroSection.addEventListener('mousemove', handleMouseMove);
    }

    heroSection.addEventListener('mouseleave', resetParallax);

    const onScroll = () => {
      const rect = heroSection.getBoundingClientRect();
      const viewportHeight = window.innerHeight;
      const scrollRatio = Math.min(Math.max(1 - rect.top / viewportHeight, 0), 1);
      layers.forEach((layer) => {
        const depth = Number(layer.dataset.depth || 0.2);
        const scrollRange = prefersReducedMotion ? 30 : 70;
        const scrollShift = scrollRatio * scrollRange * depth;
        layer.style.setProperty('--scroll-shift', `${scrollShift}px`);
      });
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();

    window.addEventListener('beforeunload', () => {
      window.removeEventListener('scroll', onScroll);
      if (!prefersReducedMotion) {
        heroSection.removeEventListener('mousemove', handleMouseMove);
      }
      heroSection.removeEventListener('mouseleave', resetParallax);
    });
  }
</script>
