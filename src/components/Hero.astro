---
// Full-width hero section with motion showcase for Outrun Studio
import { getHomepageHero, urlFor } from '../lib/sanity';

// Fetch homepage hero data from Sanity CMS
const homepageHero = await getHomepageHero();

// Debug: Log the data
console.log('Homepage Hero Data:', homepageHero);
console.log('Hero Images:', homepageHero?.heroImages?.length || 0);
console.log('homepageHero exists:', !!homepageHero);
console.log('heroImages exists:', !!homepageHero?.heroImages);
console.log('heroImages length:', homepageHero?.heroImages?.length);
console.log('Condition result:', !!(homepageHero && homepageHero.heroImages && homepageHero.heroImages.length > 0));

// Debug: Log image URLs
if (homepageHero?.heroImages) {
  homepageHero.heroImages.forEach((img: any, i: number) => {
    if (img.image) {
      const imageUrl = urlFor(img.image).width(800).height(600).fit('crop').url();
      console.log(`Image ${i + 1} URL:`, imageUrl);
    }
  });
}
---

<section class="relative w-full h-screen overflow-hidden bg-outrun-darker -mt-28 pt-28">
  <!-- Premium animated background -->
  <div class="absolute inset-0 bg-gradient-to-br from-outrun-darker via-outrun-dark to-outrun-darker"></div>
  <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>
  
  <!-- Sophisticated floating orbs with premium effects -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute top-20 right-20 w-96 h-96 bg-gradient-to-br from-outrun-neon to-outrun-blue rounded-full blur-3xl float-animation opacity-30"></div>
    <div class="absolute bottom-20 left-20 w-80 h-80 bg-gradient-to-br from-outrun-purple to-outrun-neon rounded-full blur-2xl float-animation opacity-20" style="animation-delay: 1s;"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-gradient-to-br from-outrun-blue to-outrun-purple rounded-full blur-xl float-animation opacity-15" style="animation-delay: 2s;"></div>
    
    <!-- Subtle particle effects -->
    <div class="absolute top-1/4 left-1/4 w-2 h-2 bg-outrun-neon rounded-full opacity-60 animate-pulse" style="animation-delay: 0.5s;"></div>
    <div class="absolute top-3/4 right-1/3 w-1 h-1 bg-outrun-blue rounded-full opacity-80 animate-pulse" style="animation-delay: 1.5s;"></div>
    <div class="absolute bottom-1/3 left-1/3 w-1.5 h-1.5 bg-outrun-purple rounded-full opacity-70 animate-pulse" style="animation-delay: 2.5s;"></div>
  </div>

  <!-- Design Showcase - Outrun Studio Business Card Only -->
  <div class="absolute inset-0 z-10">
    {homepageHero && homepageHero.heroImages && homepageHero.heroImages.length > 0 ? (
      <div class="w-full h-full relative">
        {homepageHero.heroImages
          .filter((heroImage: any) => heroImage.title && heroImage.title.toLowerCase().includes('outrun studio'))
          .map((heroImage: any, index: number) => (
          <div 
            class="design-slide absolute inset-0 opacity-100"
            data-slide={index}
          >
            <img 
              src={urlFor(heroImage.image).width(1920).height(1080).fit('crop').url()} 
              alt={heroImage.title || 'Outrun Studio Business Card Design'}
              class="w-full h-full object-cover image-loading"
              style="display: block;"
              loading="lazy"
              onload="this.classList.remove('image-loading'); this.style.opacity='1';"
              onerror="this.classList.remove('image-loading'); this.style.opacity='0.5';"
            />
          </div>
        ))}
        <!-- Scanlines texture overlay - outside slides so always visible -->
        <div class="absolute inset-0" style="
          background: repeating-linear-gradient(
            0deg,
            transparent,
            transparent 3px,
            rgba(0, 255, 255, 0.15) 3px,
            rgba(0, 255, 255, 0.15) 4px
          );
          animation: scanlines-move 0.1s linear infinite;
          z-index: 20;
          pointer-events: none;
          mix-blend-mode: screen;
        "></div>
      </div>
    ) : (
      <div class="w-full h-full flex items-center justify-center bg-red-500">
        <div class="text-center">
          <h2 class="text-6xl md:text-7xl font-bold text-white mb-4 font-orbitron tracking-wider">NO SANITY DATA</h2>
          <p class="text-3xl text-white font-inter font-semibold">Check Sanity Studio</p>
          <p class="text-lg text-white font-inter mt-4">Create Homepage Hero in Sanity</p>
        </div>
      </div>
    )}
  </div>

  <!-- Navigation dot - Single image -->
  <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-6 z-20">
    {homepageHero && homepageHero.heroImages && homepageHero.heroImages.filter((heroImage: any) => heroImage.title && heroImage.title.toLowerCase().includes('outrun studio')).length > 0 ? (
      <button class="nav-dot w-5 h-5 rounded-full bg-outrun-neon opacity-100 transition-all duration-500 scale-110 backdrop-blur-sm border border-white/20" data-slide="0"></button>
    ) : (
      <button class="nav-dot w-5 h-5 rounded-full bg-outrun-neon opacity-100 transition-all duration-500 scale-110 backdrop-blur-sm border border-white/20" data-slide="0"></button>
    )}
  </div>

  <!-- Modern CTA buttons -->
  <div class="absolute bottom-20 left-1/2 transform -translate-x-1/2 z-30">
    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
      <a href="/contact" class="btn-primary">
        Get a quick quote
      </a>
      <a href="/contact" class="btn-primary">
        Book a 30-min call
      </a>
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="absolute bottom-8 right-8 animate-bounce">
    <div class="w-6 h-10 border-2 border-outrun-neon rounded-full flex justify-center">
      <div class="w-1 h-3 bg-outrun-neon rounded-full mt-2"></div>
    </div>
  </div>
</section>

<style>
      .design-slide {
        transition: opacity 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      
      .design-slide.opacity-100 {
        opacity: 1;
      }
      
      .design-slide.opacity-0 {
        opacity: 0;
      }
  
  .nav-dot {
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
    overflow: hidden;
  }
  
  .nav-dot::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
  }
  
  .nav-dot:hover::before {
    left: 100%;
  }
  
  .nav-dot:hover {
    transform: scale(1.2);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
  }
  
  /* Premium loading animation */
  .image-loading {
    background: linear-gradient(90deg, #1a1a2e 25%, #16213e 50%, #1a1a2e 75%);
    background-size: 200% 100%;
    animation: shimmer 2s infinite;
  }
  
  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }
  
      /* Subtle Ken Burns effect */
      .design-slide img {
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        animation: ken-burns-subtle 25s ease-in-out infinite;
      }
      
      .design-slide:hover img {
        transform: scale(1.02);
        animation-play-state: paused;
      }
      
      /* Enhanced Ken Burns keyframes - more dramatic movement */
      @keyframes ken-burns-subtle {
        0% { transform: scale(1) translate(0, 0); }
        25% { transform: scale(1.08) translate(-2%, -1%); }
        50% { transform: scale(1.15) translate(-1%, 2%); }
        75% { transform: scale(1.08) translate(2%, 1%); }
        100% { transform: scale(1) translate(0, 0); }
      }
      
      /* Alternative subtle patterns for different slides */
      .design-slide:nth-child(2) img {
        animation: ken-burns-subtle-2 22s ease-in-out infinite;
      }
      
      .design-slide:nth-child(3) img {
        animation: ken-burns-subtle-3 28s ease-in-out infinite;
      }
      
      .design-slide:nth-child(4) img {
        animation: ken-burns-subtle-4 20s ease-in-out infinite;
      }
      
      .design-slide:nth-child(5) img {
        animation: ken-burns-subtle-5 30s ease-in-out infinite;
      }
      
      @keyframes ken-burns-subtle-2 {
        0% { transform: scale(1.05) translate(2%, 1%); }
        25% { transform: scale(1) translate(0, 0); }
        50% { transform: scale(1.08) translate(-1%, -2%); }
        75% { transform: scale(1.03) translate(1%, 1%); }
        100% { transform: scale(1.05) translate(2%, 1%); }
      }
      
      @keyframes ken-burns-subtle-3 {
        0% { transform: scale(1.08) translate(-1%, 2%); }
        25% { transform: scale(1.05) translate(1%, -1%); }
        50% { transform: scale(1) translate(0, 0); }
        75% { transform: scale(1.03) translate(-2%, 1%); }
        100% { transform: scale(1.08) translate(-1%, 2%); }
      }
      
      @keyframes ken-burns-subtle-4 {
        0% { transform: scale(1) translate(0, 0); }
        25% { transform: scale(1.03) translate(2%, -1%); }
        50% { transform: scale(1.05) translate(-1%, 1%); }
        75% { transform: scale(1.08) translate(1%, 2%); }
        100% { transform: scale(1) translate(0, 0); }
      }
      
      @keyframes ken-burns-subtle-5 {
        0% { transform: scale(1.03) translate(1%, -2%); }
        25% { transform: scale(1) translate(0, 0); }
        50% { transform: scale(1.05) translate(2%, 1%); }
        75% { transform: scale(1.08) translate(-1%, -1%); }
        100% { transform: scale(1.03) translate(1%, -2%); }
      }
      
  
  /* Premium glow effects */
  .nav-dot.bg-outrun-neon {
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.6), 0 0 30px rgba(0, 255, 255, 0.3);
    animation: pulse-glow 2s infinite;
  }
  
  @keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 15px rgba(0, 255, 255, 0.6), 0 0 30px rgba(0, 255, 255, 0.3); }
    50% { box-shadow: 0 0 25px rgba(0, 255, 255, 0.8), 0 0 40px rgba(0, 255, 255, 0.5); }
  }

  /* Scanlines Effect - Based on CodePen implementation */
  .scanlines {
    position: relative;
    pointer-events: none;
  }

  .scanlines::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 1px,
      rgba(0, 255, 255, 1) 1px,
      rgba(0, 255, 255, 1) 2px
    );
    animation: scanlines-move 0.1s linear infinite;
    z-index: 10;
    pointer-events: none;
  }

  @keyframes scanlines-move {
    0% { transform: translateY(0); }
    100% { transform: translateY(4px); }
  }
  
  /* Inline scanlines animation */
  @keyframes scanlines-move {
    0% { transform: translateY(0); }
    100% { transform: translateY(4px); }
  }
</style>

<script>
  // Premium design showcase carousel functionality
  let currentSlide = 0;
  let isTransitioning = false;
  let autoPlayInterval: number | null = null;
  const slides = document.querySelectorAll('.design-slide');
  const dots = document.querySelectorAll('.nav-dot');
  const totalSlides = slides.length;

  // Preload all images for smooth transitions
  function preloadImages() {
    const imageUrls = Array.from(slides).map(slide => {
      const img = slide.querySelector('img');
      return img ? img.src : null;
    }).filter(Boolean);
    
    imageUrls.forEach(url => {
      const img = new Image();
      img.src = url;
    });
  }

      function showSlide(index: number, direction: 'next' | 'prev' | 'direct' = 'direct') {
        if (isTransitioning || index === currentSlide) return;
        
        isTransitioning = true;
        
        // Smooth fade transition - hide all slides first
        slides.forEach((slide: Element) => {
          slide.classList.remove('opacity-100');
          slide.classList.add('opacity-0');
        });
        
        // Show the target slide with a slight delay for smooth fade
        setTimeout(() => {
          const nextSlideElement = slides[index];
          nextSlideElement.classList.remove('opacity-0');
          nextSlideElement.classList.add('opacity-100');
        }, 100);
    
    // Update navigation dots with smooth animation
    dots.forEach((dot: Element, i: number) => {
      const dotElement = dot as HTMLElement;
      if (i === index) {
        dotElement.classList.add('bg-outrun-neon', 'opacity-100');
        dotElement.classList.remove('bg-outrun-light-gray', 'opacity-50');
      } else {
        dotElement.classList.add('bg-outrun-light-gray', 'opacity-50');
        dotElement.classList.remove('bg-outrun-neon', 'opacity-100');
      }
    });
    
    currentSlide = index;
    
        // Reset transition state
        setTimeout(() => {
          isTransitioning = false;
        }, 1600);
  }

  function nextSlide() {
    const nextIndex = (currentSlide + 1) % totalSlides;
    showSlide(nextIndex, 'next');
  }

  function prevSlide() {
    const prevIndex = (currentSlide - 1 + totalSlides) % totalSlides;
    showSlide(prevIndex, 'prev');
  }

  function startAutoPlay() {
    if (totalSlides > 1) {
      autoPlayInterval = setInterval(nextSlide, 5000);
    }
  }

  function stopAutoPlay() {
    if (autoPlayInterval) {
      clearInterval(autoPlayInterval);
      autoPlayInterval = null;
    }
  }

  // Enhanced navigation dot click handlers
  dots.forEach((dot: Element, index: number) => {
    dot.addEventListener('click', () => {
      if (index !== currentSlide) {
        const direction = index > currentSlide ? 'next' : 'prev';
        showSlide(index, direction);
      }
    });
  });

  // Add keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') prevSlide();
    if (e.key === 'ArrowRight') nextSlide();
  });

  // Pause auto-play on hover
  const heroSection = document.querySelector('section');
  if (heroSection) {
    heroSection.addEventListener('mouseenter', stopAutoPlay);
    heroSection.addEventListener('mouseleave', startAutoPlay);
  }

  // Initialize
  if (totalSlides > 0) {
    preloadImages();
    showSlide(0);
    startAutoPlay();
  }
</script>
